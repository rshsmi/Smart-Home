hc_crypto_card:
  type: 'custom:button-card'
  entity: sun.sun
  show_label: false
  show_state: false
  show_name: false
  show_icon: false
  tap_action:
    action: none
  triggers_update:
    - sensor.binance_ticker_ethusdt
    - sensor.binance_ticker_solusdt
    - sensor.binance_ticker_xrpusdt

  styles:
    card:
      - background: 'transparent'
      - border-radius: 0
      - padding: 8px
      - box-shadow: 'none'
      - position: relative
      - overflow: hidden
    custom_fields:
      crypto_content:
        - padding: 0
        - margin: 0
        - width: 100%
        - height: 100%
        - position: absolute
        - left: 0
        - top: 0
        - right: 0
        - bottom: 0

  custom_fields:
    crypto_content: |
      [[[
        const cryptos = [
          {
            abbr: 'ETH',
            name: 'Ethereum',
            entity: 'sensor.binance_ticker_ethusdt',
          },
          {
            abbr: 'SOL',
            name: 'Solana',
            entity: 'sensor.binance_ticker_solusdt',
          },
          {
            abbr: 'XRP',
            name: 'XRP',
            entity: 'sensor.binance_ticker_xrpusdt',
          }
        ];

        let cryptosHtml = '';
        cryptos.forEach((crypto) => {
          const cryptoEntity = states[crypto.entity];
          const attrs = cryptoEntity ? cryptoEntity.attributes : {};
          const price = attrs.lastPrice != null ? parseFloat(attrs.lastPrice) : null;
          // Use priceChangePercent to determine color
          let nameColor = '#505050'; // Default to dark gray
          if (attrs && attrs.priceChangePercent) {
            const change = parseFloat(attrs.priceChangePercent);
            if (change > 0) {
              nameColor = '#2ecc71'; // green for increase
            } else if (change < 0) {
              nameColor = '#FF6B6B'; // red for decrease
            }
          }
          const priceStr = price != null ? price.toFixed(2) : '--';
          cryptosHtml += `
            <div style="
              background: transparent;
              border: 1px solid #e0e0e0;
              border-radius: 0px;
              width: 140px;
              min-width: 140px;
              max-width: 140px;
              height: 60px;
              min-height: 60px;
              max-height: 60px;
              display: flex;
              flex-direction: row;
              align-items: center;
              justify-content: center;
              margin-bottom: 0;
              box-sizing: border-box;
            ">
              <div style="display: flex; justify-content: center; align-items: center; gap: 8px; font-size: 19px; font-weight: bold; height: 60px; text-align: center;">
                <span style='color: ${nameColor};'>${crypto.abbr}</span>
                <span style='color: #505050;'>${priceStr}</span>
              </div>
            </div>
          `;
        });
        // Wrap all boxes in a horizontal flex row, perfectly centered
        return `
          <div style="position: relative; width: 100%; height: 100%; box-sizing: border-box; margin: 0; padding: 0; display: flex; align-items: center; justify-content: center;">
            <div style="display: flex; flex-direction: row; align-items: center; justify-content: center; gap: 8px; width: auto;">
              ${cryptosHtml}
            </div>
          </div>
        `;
      ]]]
