hc_london_underground_card:
  type: 'custom:button-card'
  entity: sun.sun
  show_label: false
  show_state: false
  show_name: false
  show_icon: false
  tap_action:
    action: none
  triggers_update:
    - sensor.london_underground_northern
    - sensor.london_underground_piccadilly

  styles:
    card:
      - background: 'transparent'
      - border-radius: 0
      - padding: 8px
      - box-shadow: 'none'
      - position: relative
      - min-height: 120px
      - max-height: 140px
      - overflow-y: auto
    custom_fields:
      tube_content:
        - padding: 0
        - margin: 0
        - width: 100%
        - height: 100%
        - position: absolute
        - left: 0
        - top: 0
        - right: 0
        - bottom: 0

  custom_fields:
    tube_content: |
      [[[
        const lines = [
          {
            name: 'Piccadilly',
            entity: 'sensor.london_underground_piccadilly',
            color: '#0019A8',
          },
          {
            name: 'Northern',
            entity: 'sensor.london_underground_northern',
            color: '#000000',
          }
        ];

        // Get statuses for both lines
        const getStatus = (entity) => {
          if (!entity) return 'Unknown';
          if (entity.state === 'Good Service') return 'Good Service';
          if (entity.state === 'Service Closed') return 'Service Closed';
          return 'Delayed Service';
        };
        const piccadillyEntity = states['sensor.london_underground_piccadilly'];
        const northernEntity = states['sensor.london_underground_northern'];
        const piccadillyStatus = getStatus(piccadillyEntity);
        const northernStatus = getStatus(northernEntity);
        // Render both in a single row
        return `
          <div style="position: relative; width: 100%; height: 60px; box-sizing: border-box; margin: 0; padding: 0; display: flex; flex-direction: row; align-items: stretch; justify-content: center; gap: 8px;">
            <div style="background: #0019A8; border: 1px solid #e0e0e0; border-radius: 0; width: 50%; height: 50px; display: flex; align-items: center; justify-content: flex-start; box-sizing: border-box;">
              <div style="display: flex; align-items: center; font-size: 22px; font-weight: bold; height: 50px; text-align: left; color: #fff; width: 100%; padding-left: 12px;">
                <span style='color: #fff;'>${piccadillyStatus}</span>
              </div>
            </div>
            <div style="background: #000000; border: 1px solid #e0e0e0; border-radius: 0; width: 50%; height: 50px; display: flex; align-items: center; justify-content: flex-start; box-sizing: border-box;">
              <div style="display: flex; align-items: center; font-size: 22px; font-weight: bold; height: 50px; text-align: left; color: #fff; width: 100%; padding-left: 12px;">
                <span style='color: #fff;'>${northernStatus}</span>
              </div>
            </div>
          </div>
        `;
      ]]]
