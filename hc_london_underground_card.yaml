hc_london_underground_card:
  type: 'custom:button-card'
  entity: sun.sun
  show_label: false
  show_state: false
  show_name: false
  show_icon: false
  tap_action:
    action: none
  triggers_update:
    - sensor.london_underground_northern
    - sensor.london_underground_piccadilly
    - sensor.london_underground_elizabeth

  styles:
    card:
      - background: 'transparent'
      - border-radius: 12px
      - padding: 8px
      - box-shadow: 'none'
      - position: relative
      - min-height: 120px
      - max-height: 140px
      - overflow-y: auto
    custom_fields:
      tube_content:
        - padding: 0
        - margin: 0
        - width: 100%
        - height: 100%
        - position: absolute
        - left: 0
        - top: 0
        - right: 0
        - bottom: 0

  custom_fields:
    tube_content: |
      [[[
        const lines = [
          {
            name: 'Piccadilly',
            entity: 'sensor.london_underground_piccadilly',
            color: '#0019A8',
          },
          {
            name: 'Northern',
            entity: 'sensor.london_underground_northern',
            color: '#000000',
          }
        ];

        let tubeHtml = '';
        lines.forEach((line, index) => {
          const lineEntity = states[line.entity];
          const status = lineEntity ? lineEntity.state : 'Unknown';
          tubeHtml += `
            <div style="
              background: ${line.color};
              border: 1px solid #e0e0e0;
              border-radius: 0px;
              width: 100%;
              height: 50px;
              display: flex;
              flex-direction: row;
              align-items: center;
              justify-content: flex-start;
              margin-bottom: 0;
              box-sizing: border-box;
            ">
              <div style="display: flex; align-items: center; font-size: 22px; font-weight: bold; height: 50px; text-align: left; color: #fff; width: 100%; padding-left: 12px;">
                <span style='color: #fff;'>${status}</span>
              </div>
            </div>
          `;
        });
        // Wrap all boxes in a vertical flex column, full width
        return `
          <div style="position: relative; width: 100%; height: 100%; box-sizing: border-box; margin: 0; padding: 0; display: flex; align-items: stretch; justify-content: center;">
            <div style="display: flex; flex-direction: column; align-items: stretch; justify-content: center; gap: 8px; width: 100%;">
              ${tubeHtml}
            </div>
          </div>
        `;
      ]]]
